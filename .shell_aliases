#!/bin/sh

alias ls="ls -F" # --color=auto"
alias mv="mv -i"
alias cp="cp -i -p"

cd_helper() {
  if [ "$#" -lt 1 ]; then
    echo "cd_helper: Expecting exactly one or two arguments" >&2
    return 1
  fi
  local cmd="$1"
  if [ "$#" -gt 2 ]; then
    echo "${cmd}: Expecting exactly zero or one arguments" >&2
    return 1
  fi
  if [ "$#" -eq 1 ]; then
    builtin "${cmd}"
    return
  fi

  local dest="$2"
  if [ -f "${dest}" ]; then
    #Â dirname will output . if there isn't a directory in $dest.
    dest="$(dirname "${dest}")"
  fi
  builtin "${cmd}" "${dest}"
}

cd() {
  cd_helper cd "$@"
}
pushd() {
  cd_helper pushd "$@"
}

ta() {
  tmux attach -d || tmux new
}
top () {
  local top_args=""
  # top on Mac OS X does not sort by CPU by default; fix that.
  if [ "${OSTYPE#darwin}" != "${OSTYPE}" ]; then
    top_args="-o cpu"
  fi
  TOP="$((${LINES:-24} - 7))" command top ${top_args} "$@"
}
sortdu () {
	if [ "$#" = 0 ]; then
		du -sxk * .??* | sort -n
	else
		du -sxk "$@" | sort -n
	fi
}
sortduh () {
    sortdu "$@" | awk '{ $1 = $1 * 1024; print; }' | human
}
strictperl () {
    perl -Mstrict -w -MData::Dumper "$@"
}
cdpwd () {
    cd "$(/bin/pwd)"
}

git () {
    # MacOS env doesn't have --unset.
    ( unset LESS; command git "$@" )
}

ikiwiki-johntobin.ie () {
    if ! type tidy > /dev/null; then
        echo "apt-get install tidy" >&2
        return 1
    fi
    ikiwiki --setup ~/.ikiwiki/johntobin.ie "$@"
}

ikiwiki-johntobin.ie-preview () {
    ikiwiki-johntobin.ie --render "$@" | w3m -T text/html
}

clisp () {
    (ulimit -v 1048576 && command clisp -ansi -m 128MB "$@")
}

bc() {
  if [ -t 0 -a "$#" -eq 0 ]; then
    command bc -q -i "${HOME}/.bcrc"
  else
    command bc "$@"
  fi
}

# Adapted from http://www.chiark.greenend.org.uk/~sgtatham/aliases.html
_echo-literally-helper() {
    history 1 | perl -pe 's/^ *[0-9]+ +[^ ]+ //'
}
alias echo-literally='_echo-literally-helper #'

irssi() {
  TERM=xterm-color command irssi "$@"
}

shell_functions() {
  set | grep '() $'
}

countsort() {
  sort "$@" | uniq -c | sort -n
}

only_duplicates() {
  fmt -1 "$@" | sort | uniq -d | xargs echo
}

delete-ipad-app-backups() {
    rm "${HOME}/Music/iTunes/iTunes Media/Mobile Applications"/*
}

timestamp-to-human-localtime() {
  strictperl -n -e 'print scalar localtime $_, qq{\n}'
}

godocl() {
  go doc "$@" | less
}
godocf() {
  go doc "$@" | grep ^func
}
godocserver() {
  echo "http://localhost:12345/"
  godoc --http=:12345
}
gocdpkg() {
  local pdir
  pdir="$(go list -f '{{ .Dir }}' "$1")"
  if [ -z "${pdir}" ]; then
    echo "no directory found for pkg $1"
    return 1
  fi
  cd "${pdir}"
}
