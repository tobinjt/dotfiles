#!/bin/bash

# Shell-neutral environment variables needed for interactive shells.
# We do enough to set $PATH, then check for being an interactive shell: if we're
#   not interactive we skip everything else.

# shellcheck disable=SC1090
. "${HOME}/.shell_functions"

# If homebrew is in use, put it first so I can replace system binaries like
# vim.
if [ -d "/usr/local/Cellar" ]; then
    PATH="/usr/local/bin:/usr/local/sbin:${PATH}"
    MANPATH="/usr/local/man:${MANPATH}"
fi
if [ -d "/usr/local/go/bin" ]; then
    PATH="/usr/local/go/bin:${PATH}"
fi
PATH="${HOME}/gbin:${HOME}/bin:${HOME}/src/gopath/bin:${PATH}"
PATH="${PATH}:/sbin:/usr/sbin"
PATH="$(deduplicate_path "${PATH}")"
# EDITOR is set here so that it's correct when running non-interactively, e.g.
# when sshing in to run update-dotfiles-and-bin, whch runs git pull, which needs
# a commit message for merges.
EDITOR="vim"
export EDITOR PATH

if [ "$-" = "${-//i/}" ]; then
  # This is not an interactive shell, skip everything else in this file.
  return
fi

# The trailing : is important on Linux; it means to append the standard
# search path to ${MANPATH}.
MANPATH="$(deduplicate_path "${HOME}/man${MANPATH:+:}${MANPATH:-}:")"
# Where Go should install stuff.
# Also trick Go into finding things in ~/src.
GOPATH="$(deduplicate_path "${HOME}/src/gopath:${HOME}${GOPATH:+:}${GOPATH:-}")"
export MANPATH GOPATH

# Replace xterm* with the best available.
case "${TERM}" in
  xterm*)
    for term in xterm xterm-color xterm-256color; do
      if tput -T"${term}" longname > /dev/null 2>&1; then
        TERM="${term}"
      fi
    done
  ;;
esac
export TERM

BROWSER="google-chrome"
if which colordiff > /dev/null 2>&1; then
  DIFF="colordiff -u"
else
  DIFF="diff -u"
fi
PAGER="less"
# Don't create or use a shared connection for rsync.
RSYNC_RSH="ssh -o ControlPath=none"
# smart case matching; long prompt; suppress dumb terminal error messages;
# allow ANSI colour escape sequences; highlight the first new line when
# moving through the file
LESS="iMdRW${LESS}"
PYTHONDONTWRITEBYTECODE="No .pyc files please"
export BROWSER DIFF LESS PAGER PYTHONDONTWRITEBYTECODE RSYNC_RSH

# If grep supports colour then turn it on.
if (echo foo | grep -q --color=auto foo 2> /dev/null); then
  alias grep='grep --color=auto'
fi

# Sort filenames as I expect them to be sorted, regardless of locale.
LC_COLLATE="C"
export LC_COLLATE
